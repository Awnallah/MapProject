function initViewModel(){ko.applyBindings(new ViewModel)}var singedMeetupUrl="https://api.meetup.com/2/open_events?and_text=False&offset=0&format=json&lon=-122.25851&limited_events=False&photo-host=public&text=runing+run+jogging+hiking&page=20&radius=15&category=9&lat=37.806349&status=upcoming&desc=False&sig_id=185474821&sig=774927aef4ea1cb19313b3f41dde24adc6966d05",customMeetupUrl="https://api.meetup.com/2/open_events?&photo-host=public&text=jog+run+hike&category=9&page=20&status=upcoming&desc=False&key=92473e3d65402c53a67252350&&sign=true&country=US&key=92473e3d65402c53a67252350",weatherApi="https://api.forecast.io/forecast/d5bb4142f6d7be37a8aa855e52dd0f31/",Meetup=function(e){this.url=e.event_url,this.name=e.name,this.time=e.time,this.date=function(){var t={weekday:"long",hour:"numeric",year:"numeric",month:"long",day:"numeric",timeZoneName:"short"};return new Date(e.time).toLocaleDateString("en-US",t)},this.lat=e.venue.lat,this.lng=e.venue.lon,this.venueName=e.venue.name,this.address=e.venue.address_1,this.city=e.venue.city,this.state=e.venue.state,this.marker=new google.maps.Marker({position:{lat:this.lat,lng:this.lng},icon:"dist/icon.png",title:this.name}),this.infoWindow=new google.maps.InfoWindow,this.weather={}},ViewModel=function(){var e,t=this,a=37.806112,n=-122.258038;t.searchValue=ko.observable("Berkeley, CA"),t.searchRadius=ko.observable(15),t.inputFilter=ko.observable(""),t.meetupList=ko.observableArray([]),t.meetupListFiltered=ko.observableArray([]),t.cleanUpList=function(){t.meetupList().forEach(function(e){e.marker.setMap(null)}),t.meetupList([])},t.getMeetups=function(e){t.cleanUpList(),$.ajax({type:"GET",url:e,timeout:5e3,contentType:"application/json",dataType:"jsonp",cache:!1}).done(function(e){for(var a=e.results,n=0;n<a.length;n++)a[n].venue&&a[n].venue.lat&&a[n].venue.lon&&t.meetupList.push(new Meetup(a[n]));t.filter(),$("#search-status").text("")}).fail(function(e){$("#search-status").text("(Meetup data could not be loaded)")})},t.filter=function(){t.meetupListFiltered().forEach(function(e){e.marker.setMap(null)}),t.meetupListFiltered([]);var e=t.meetupList().filter(function(e){return-1!=e.name.toLowerCase().indexOf(t.inputFilter().toLowerCase())});e.forEach(function(e){t.meetupListFiltered.push(e)}),t.addMarkers()},t.addMarkers=function(){for(var a=0;a<t.meetupListFiltered().length;a++)t.meetupListFiltered()[a].marker.setMap(e),t.weatherRequest(t.meetupListFiltered()[a]);t.meetupListFiltered().forEach(function(e){e.marker.addListener("click",function(){t.meetupClicked(e)})})},t.meetupClicked=function(a){t.meetupListFiltered().forEach(function(e){e.infoWindow.close(),e.marker.setAnimation(null)}),a.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.marker.setAnimation(null)},1400);var n;n=a.weather.summary&&a.weather.apparentTemperature?"<p> Expected Weather: <i>"+a.weather.summary+" with Temp of "+a.weather.apparentTemperature+" &deg;  F </i></p>":"Weather forecast is not available yet",a.infoWindow.setContent('<div class="infoWindow"<h5><a href="'+a.url+'" target="_blank">'+a.name+"</a> </h5><p>"+a.address+", "+a.city+" </br> Time: "+a.date()+"</p>"+n+"</div>"),a.infoWindow.open(e,a.marker),e.setCenter({lat:a.lat,lng:a.lng}),google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.marker.setAnimation(null)})},t.weatherRequest=function(e){var t=weatherApi+e.lat+","+e.lng+","+e.time/1e3;$.ajax({url:t,dataType:"jsonp",timeout:3e3}).done(function(t){var a=t.currently;e.weather=a}).fail(function(t){e.weather={}})},t.initMap=function(){e=new google.maps.Map(document.getElementById("map"),{center:{lat:37.806112,lng:-122.258038},zoom:11,styles:[{featureType:"poi",stylers:[{visibility:"on"}]},{featureType:"transit.station",stylers:[{visibility:"off"}]}],disableDoubleClickZoom:!1})},t.newSearch=function(){function i(){var i=o.getPlaces();a=i[0].geometry.location.lat(),n=i[0].geometry.location.lng(),e.setCenter({lat:a,lng:n}),t.getMeetups(customMeetupUrl+"&lat="+a+"&lon="+n+"&radius="+t.searchRadius())}var r=document.getElementById("inputSearch"),o=new google.maps.places.SearchBox(r);o.addListener("places_changed",i)},t.radiusFilter=function(){if(parseInt(t.searchRadius())==t.searchRadius()){var e=customMeetupUrl+"&lat="+a+"&lon="+n+"&radius="+t.searchRadius();t.getMeetups(e)}else alert("The Search Radius Must Be A Number!")},t.initMap(),t.getMeetups(singedMeetupUrl),t.newSearch()};