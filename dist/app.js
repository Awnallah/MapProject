var url="https://api.meetup.com/2/open_events?and_text=False&offset=0&format=json&lon=-122.25851&limited_events=False&photo-host=public&text=runing+run+jogging+hiking&page=20&radius=15&category=9&lat=37.806349&status=upcoming&desc=False&sig_id=185474821&sig=774927aef4ea1cb19313b3f41dde24adc6966d05",newurl="https://api.meetup.com/2/open_events?&photo-host=public&text=jog+run+hike&category=9&page=20&status=upcoming&desc=False&key=92473e3d65402c53a67252350&&sign=true&country=US&key=92473e3d65402c53a67252350",weatherApi="https://api.forecast.io/forecast/d5bb4142f6d7be37a8aa855e52dd0f31/",Meetup=function(e){var t=this;t.url=e.event_url,t.name=e.name,t.time=e.time,t.date=function(){return new Date(e.time)},t.lat=e.venue.lat,t.lng=e.venue.lon,t.venueName=e.venue.name,t.address=e.venue.address_1,t.city=e.venue.city,t.state=e.venue.state,t.marker=new google.maps.Marker({position:{lat:t.lat,lng:t.lng},icon:"dist/icon.png",title:t.name}),t.infoWindow=new google.maps.InfoWindow,t.weather=ko.observable()},ViewModel=function(){var e,t=this,a=37.806112,n=-122.258038;t.searchValue=ko.observable("Berkeley, CA"),t.searchRadius=ko.observable(15),t.meetupList=ko.observableArray([]),t.cleanUpList=function(){t.meetupList().forEach(function(e){e.marker.setMap(null)}),t.meetupList([])},t.getMeetups=function(a){t.cleanUpList(),$.ajax({type:"GET",url:a,timeout:5e3,contentType:"application/json",dataType:"jsonp",cache:!1,success:function(a){for(var n=a.results,i=0;i<n.length;i++)n[i].venue&&n[i].venue.lat&&n[i].venue.lon&&t.meetupList.push(new Meetup(n[i]));for(var i=0;i<t.meetupList().length;i++)t.meetupList()[i].marker.setMap(e),t.weatherRequest(t.meetupList()[i]),function(e){t.meetupList()[e].marker.addListener("click",function(){t.meetupClicked(t.meetupList()[e])})}(i);$("#search-status").text("")},error:function(e){$("#search-status").text("(Meetup data could not be loaded)")}})},t.meetupClicked=function(a){if(t.meetupList().forEach(function(e){e.infoWindow.close(),e.marker.setAnimation(null)}),a.marker.setAnimation(google.maps.Animation.BOUNCE),a.weather().summary&&a.weather().apparentTemperature)var n="<p> Expected Weather: <i>"+a.weather().summary+" with Temp of "+a.weather().apparentTemperature+" &deg;  F </i></p>";else var n="Weather forecast is not available yet";a.infoWindow.setContent('<div<h5><a href="'+a.url+'" target="_blank">'+a.name+"</a> </h5><p>"+a.address+", "+a.city+" </br> Time: "+a.date()+"</p>"+n+"</div>"),a.infoWindow.open(e,a.marker),google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.marker.setAnimation(null)})},t.weatherRequest=function(e){var t=weatherApi+e.lat+","+e.lng+","+e.time/1e3;$.ajax({url:t,dataType:"jsonp",success:function(t){var a=t.currently;e.weather(a)},error:function(t){e.weather("")}})},t.initMap=function(){e=new google.maps.Map(document.getElementById("map"),{center:{lat:a,lng:n},zoom:12,styles:[{featureType:"poi",stylers:[{visibility:"on"}]},{featureType:"transit.station",stylers:[{visibility:"off"}]}],disableDoubleClickZoom:!1})},t.newSearch=function(){function i(){var i=r.getPlaces();a=i[0].geometry.location.lat(),n=i[0].geometry.location.lng(),e.setCenter({lat:a,lng:n}),t.getMeetups(newurl+"&lat="+a+"&lon="+n+"&radius="+t.searchRadius())}var o=document.getElementById("inputSearch"),r=new google.maps.places.SearchBox(o);r.addListener("places_changed",i)},t.radiusFilter=function(){var e=newurl+"&lat="+a+"&lon="+n+"&radius="+t.searchRadius();console.log(e),t.getMeetups(e)},t.initMap(),t.getMeetups(url),t.newSearch()};ko.applyBindings(new ViewModel);